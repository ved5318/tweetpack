version: 1.0

description: A Workflow to create ubuntu vm using template.

input:
  - username
  - consumer_key
  - consumer_secret
  - access_key
  - access_secret
  

vars:
  - result: ''
  - error: ''
tasks:    


  get_tweets:
    action: tweetpack.fetch
    input:
      username: <% ctx().username %>
      consumer_key: <% ctx().consumer_key %>
      consumer_secret: <% ctx().consumer_secret %>
      access_key: <% ctx().access_key %>
      access_secret: <% ctx().access_secret %>
      
      timeout: 3600
    next:
      - when: <% succeeded() %>
        publish:
          - result: "{{ result() }}"
        '''do:
          - send_tweets'''
      - when: <% failed() %>
        publish:
          - result: "{{ result() }}"
        do:
          - finish_failed 
  send_tweets:
    action: tweetpack.send
    input:
      text: <% task(get_tweets).result.result%>
      
      timeout: 3600
    next:
      - when: <% succeeded() %>
        publish:
          - result: "{{ result() }}"
      - when: <% failed() %>
        publish:
          - result: "{{ result() }}"
        do:
          - finish_failed 
  finish_failed:
    action: core.echo
    input:
      message: "failed"    
  output:
  - result: '{{ ctx().result }}'
  - error: '{{ ctx().error }}'         
  